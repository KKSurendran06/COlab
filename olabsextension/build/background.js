import{g as d,m as p,e as h,f,n as x,s as w}from"./assets/firebase-BeYSiOL_.js";chrome.tabs.onUpdated.addListener(async(r,s,e)=>{if(s.status==="complete"&&e.url){const t=await d("experimentDetails");if(t)try{await p(h(f,"experiments"),{sub:t.sub,sim:t.sim,cnt:t.cnt,url:e.url,title:await m(e.url),timestamp:x()}),console.log("User added to experiment tracking:",t)}catch(n){console.error("Error adding document to Firestore:",n)}}});chrome.runtime.onMessage.addListener((r,s,e)=>{if(r.action==="fetchExperimentTitle")return m(r.url).then(t=>{w("experimentTitle",t),e({success:!0,title:t})}).catch(t=>{console.error("Error in fetchExperimentTitle:",t),e({success:!1,error:t.toString()})}),!0});async function m(r){var s;try{const t=(await chrome.tabs.query({active:!0,currentWindow:!0}))[0];if(t&&t.url===r&&t.id){const o=await chrome.scripting.executeScript({target:{tabId:t.id},func:()=>{var u;const a=document.querySelector(".title");return((u=a==null?void 0:a.textContent)==null?void 0:u.trim())||document.title||"Unknown Experiment"}});if(o&&o[0]&&o[0].result)return o[0].result}const n=await fetch(r,{method:"GET",headers:{Accept:"text/html"}});if(!n.ok)throw new Error(`Failed to fetch page: ${n.status} ${n.statusText}`);const l=await n.text(),i=new DOMParser().parseFromString(l,"text/html"),c=i.querySelector(".title");return((s=c==null?void 0:c.textContent)==null?void 0:s.trim())||i.title||"Unknown Experiment"}catch(e){return console.error("Error fetching title:",e),"Unknown Experiment"}}
